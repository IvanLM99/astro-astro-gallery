---
const { activeTab = 'gallery', lang = 'es' } = Astro.props;

const galleryUrl = lang === 'es' ? '/gallery' : `/${lang}/gallery`;
const universeUrl = lang === 'es' ? '/universe' : `/${lang}/universe`;
---

<nav id="navbar">
    <div class="nav-left">
        <a href={`/${lang}`} class="site-title">I. LOPEZ</a>
    </div>

    <div class="nav-center">
        <a href={galleryUrl} class={`menu-btn ${activeTab === 'gallery' ? 'active' : ''}`} id="btn-gallery" data-t="nav_gallery">GALER√çA</a>
        <a href={universeUrl} class={`menu-btn ${activeTab === 'universe' ? 'active' : ''}`} id="btn-universe" data-t="nav_portfolio">MI UNIVERSO</a>
    </div>

    <div class="nav-right">
        <div class="lang-select">
            <span id="lang-en" class={`lang ${lang === 'en' ? 'active' : ''}`} data-lang="en">EN</span> /
            <span id="lang-es" class={`lang ${lang === 'es' ? 'active' : ''}`} data-lang="es">ES</span>
        </div>
    </div>
</nav>

<script>
    import { translations } from '../data/translations.js';

    // Scroll to top on page load/refresh (fixes tab switch scroll issue)
    if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);

    // Navbar scroll hide/show
    const navbar = document.getElementById('navbar');
    let lastScrollY = window.scrollY;

    window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;
        if(navbar) {
            if (currentScrollY > lastScrollY && currentScrollY > 100) {
                navbar.classList.add('nav-hidden');
            } else {
                navbar.classList.remove('nav-hidden');
            }
            if (currentScrollY > 50) {
                navbar.classList.add('nav-faded');
            } else {
                navbar.classList.remove('nav-faded');
            }

            const stBtn = document.getElementById('scroll-top-btn');
            if(stBtn) {
                 if(currentScrollY > 500) stBtn.classList.add('visible');
                 else stBtn.classList.remove('visible');
            }
        }
        lastScrollY = currentScrollY;
    }, {passive: true});

    // Language Logic
    const langEn = document.getElementById('lang-en');
    const langEs = document.getElementById('lang-es');
    
    function setLanguage(lang) {
        // Store preference
        localStorage.setItem('preferred-lang', lang);
        
        // Update active state
        langEn?.classList.toggle('active', lang === 'en');
        langEs?.classList.toggle('active', lang === 'es');
        
        // Dispatch event for other components
        window.dispatchEvent(new CustomEvent('langChange', { detail: { lang } }));
        
        // Navigate to same page in new language
        const currentPath = window.location.pathname;
        const newPath = currentPath.replace(/^\/(es|en)\//, `/${lang}/`);
        if (newPath !== currentPath) {
            window.location.href = newPath + window.location.search;
        }
    }

    langEn?.addEventListener('click', () => setLanguage('en'));
    langEs?.addEventListener('click', () => setLanguage('es'));

    // Set initial language from URL or localStorage
    const pathLang = window.location.pathname.match(/^\/(en|es)\//);
    if (pathLang) {
        setLanguage(pathLang[1]);
    } else if (localStorage.getItem('preferred-lang')) {
        setLanguage(localStorage.getItem('preferred-lang'));
    }
</script>
